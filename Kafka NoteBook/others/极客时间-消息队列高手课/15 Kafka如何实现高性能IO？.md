
Kafka单个节点的极限处理能力接近每秒钟2000万条消息，吞吐量达到每秒钟600M。

如何做到高性能（通用做法）：
- 全异步化的线程模型
- 高性能的异步网络传输
- 自定义的私有传输协议
- 序列化和反序列化
- 。。。


这些方法和优化技巧都可以在Kafka的源代码中找到对应的实现。今天说的是Kafka的那些 “独门绝技”。

## 使用批量服务提升服务端处理能力

在Kafka内部，消息都是以“批”为单位进行处理的。

虽然Kafka的Producer只提供了单条发送的send()方法，并没有提供任何批量发送的接口，但当你调用send()方法发送一条消息后，无论你是选择同步发送还是异步发送，Kafka都不会把这条消息立即发送出去。

它会先把消息放到内存中缓存起来，然后选择合适的时机把缓存中的所有消息组成一批，一次性发给Broker。简单说，就是攒一波一起发。

在Broker整个的处理流程中，无论是写入磁盘、从磁盘读出来、还是复制到其他副本这些流程中，批消息都不会被解开，一直是作为一条“批消息”来进行处理的。

在消费时，消息同样是以批为单位进行传递的。Consumer从Broker拉到一批消息后，在客户端把批消息解开，再一条一条的交给用户代码处理。